<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Docentes Brown ‚Äî Plataforma educativa</title>
  <meta name="description" content="Herramientas, podcast y noticias de Docentes Brown." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --azul:#24496e;     /* primario */
      --crema:#f3efdc;    /* fondo */
      --violeta:#6c467e;  /* acento 1 */
      --coral:#da6863;    /* acento 2 */
      --negro:#101418;
      --gris:#5b6572;
      --borde:#e7e3d8;
      --whatsapp:#2b647b; /* pedido previo */
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--negro);background:var(--crema)}

    /* Layout */
    .container{width:min(1100px,92%);margin-inline:auto}
    header{position:sticky;top:0;background:rgba(243,239,220,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--borde);z-index:50}
    nav{display:flex;align-items:center;justify-content:space-between;padding:.8rem 0}
    .brand{display:flex;align-items:center;gap:.65rem;font-weight:800;color:var(--azul);letter-spacing:.2px}
    .brand svg{width:34px;height:34px}
    .nav-links{display:flex;gap:1rem;align-items:center}
    .nav-links a{font-weight:600;color:var(--azul);text-decoration:none;padding:.4rem .6rem;border-radius:10px}
    .nav-links a:hover{background:#eae5d3}

    /* Hero */
    .hero{position:relative;overflow:hidden}
    .hero-inner{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;align-items:center;padding:3.2rem 0}
    @media (max-width:920px){.hero-inner{grid-template-columns:1fr;padding:2.2rem 0}}
    .badge{display:inline-flex;align-items:center;gap:.5rem;background:#fff;border:1px solid var(--borde);border-radius:999px;padding:.35rem .7rem;font-weight:600;color:var(--violeta)}
    .title{font-size:clamp(1.8rem,3.5vw,3rem);line-height:1.1;margin:.8rem 0 .4rem 0;color:var(--azul)}
    .subtitle{color:var(--gris);font-size:1.05rem}
    .cta-row{display:flex;flex-wrap:wrap;gap:.8rem;margin-top:1.2rem}
    .btn{border:none;cursor:pointer;border-radius:14px;padding:.8rem 1rem;font-weight:700;letter-spacing:.2px}
    .btn-primary{background:linear-gradient(135deg,var(--violeta),var(--coral));color:#fff}
    .btn-outline{background:#fff;border:1px solid var(--borde);color:var(--azul)}

    .card{background:#fff;border:1px solid var(--borde);border-radius:18px;box-shadow:0 8px 24px rgba(16,20,24,.04)}

    /* Apps grid */
    .apps{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin:2.4rem 0}
    @media (max-width:920px){.apps{grid-template-columns:1fr 1fr}}
    @media (max-width:620px){.apps{grid-template-columns:1fr}}
    .app-card{padding:1.1rem;display:flex;flex-direction:column;gap:.6rem}
    .app-card h3{margin:.2rem 0;color:var(--azul)}
    .app-card a.btn-link{align-self:flex-start;border:1px solid var(--borde);padding:.55rem .8rem;border-radius:12px;text-decoration:none;color:var(--azul);font-weight:700}

    /* Podcast & Noticias */
    .section-title{color:var(--azul);margin:0 0 .6rem 0}
    .audio-list{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
    @media (max-width:820px){.audio-list{grid-template-columns:1fr}}
    .audio-card{padding:1rem}
    .audio-card h4{margin:.2rem 0;color:var(--violeta)}
    .news-list{display:grid;gap:.8rem}
    .news-item{padding:1rem}
    .news-item h4{margin:.1rem 0;color:var(--violeta)}

    /* News Top grid in hero */
    .news-top{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
    @media (max-width:920px){.news-top{grid-template-columns:1fr}}
    .news-card{display:flex;flex-direction:column;gap:.5rem;padding:1rem}
    .news-card h4{margin:.1rem 0;color:var(--violeta)}

    /* CTA Sumate */
    .cta{padding:1.6rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}
    @media (max-width:820px){.cta{flex-direction:column;align-items:flex-start}}

    /* Footer */
    footer{margin-top:2.4rem;border-top:1px solid var(--borde);padding:1.2rem 0;color:var(--gris)}
    footer a{color:var(--violeta);font-weight:700;text-decoration:none}

    /* Floating buttons */
    .floating{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:.6rem;z-index:60}
    .floating a{display:inline-flex;align-items:center;gap:.5rem;padding:.7rem .9rem;border-radius:999px;color:#fff;text-decoration:none;box-shadow:0 10px 26px rgba(0,0,0,.15)}
    .floating .wa{background:var(--whatsapp)}
    .floating .cafecito{background:var(--coral)}

    /* Dark mode */
    [data-theme="dark"]{--azul:#e5ecf3;--crema:#0f141a;--violeta:#b69ad2;--coral:#ff8a80;--negro:#eef2f6;--gris:#b0bac6;--borde:#2a2f36;--whatsapp:#2b647b}
    [data-theme="dark"] body{background:var(--crema);color:var(--negro)}
    [data-theme="dark"] header{background:rgba(15,20,26,.92);border-color:var(--borde)}
    [data-theme="dark"] .card{background:#131a22;border-color:var(--borde);box-shadow:0 8px 24px rgba(0,0,0,.3)}
    [data-theme="dark"] .nav-links a{color:var(--azul)}
    [data-theme="dark"] .btn-outline{background:transparent;border-color:#3a4350;color:#e5ecf3}
    .logo-img{height:44px;width:auto;display:block}

    /* HERO banner sin espacios en blanco */
    .hero-banner{position:relative;background:linear-gradient(135deg,var(--violeta),var(--coral));padding:0}
    .news-carousel{position:relative;min-height:360px}
    .news-slide{position:relative;isolation:isolate;display:grid;grid-template-columns:1fr;padding:2.4rem;transition:opacity .35s ease}
    .news-bg{position:absolute;inset:0;z-index:-1;background-size:cover;background-position:center;filter:brightness(.7)}
    .news-content{max-width:860px;color:#fff}
    .news-content h2{margin:.2rem 0 0;font-size:clamp(1.6rem,3vw,2.4rem)}
    .news-content p{margin:.5rem 0 1rem 0}
    .news-content .btn-link{display:inline-block;background:#ffffffcc;color:#1d2430;padding:.55rem .8rem;border-radius:12px;text-decoration:none;border:1px solid var(--borde)}
    .news-controls{position:absolute;left:0;right:0;bottom:12px;display:flex;align-items:center;justify-content:center;gap:.6rem}
    .news-prev,.news-next{border:1px solid var(--borde);background:#fff;border-radius:10px;padding:.3rem .55rem;cursor:pointer}
    .news-dots{display:flex;gap:.35rem}
    .news-dot{width:10px;height:10px;border-radius:999px;background:#ffffff80;border:1px solid #fff;cursor:pointer}
    .news-dot.active{background:#fff}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand" aria-label="Docentes Brown">
          <img src="logo-docentes-brown.png" alt="Docentes Brown" class="logo-img"/>
        </div>
        <div class="nav-links">
          <a href="#apps">Herramientas</a>
          <a href="#podcast">Podcast</a>
          <a href="#noticias">Noticias</a>
          <a href="#sumate">Sumate</a>
          <button id="toggleTheme" class="btn btn-outline" style="margin-left:.5rem">Modo oscuro</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- HERO: Carrusel de noticias a pantalla completa del banner -->
  <section class="hero hero-banner">
    <div class="container" style="padding:0">
      <div id="newsCarousel" class="news-carousel" aria-roledescription="carousel" aria-label="Noticias destacadas">
        <div class="news-slide" data-index="0"></div>
        <div class="news-controls">
          <button class="news-prev" aria-label="Anterior">‚óÄ</button>
          <div class="news-dots" role="tablist" aria-label="Paginaci√≥n de noticias"></div>
          <button class="news-next" aria-label="Siguiente">‚ñ∂</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Herramientas / Apps -->
  <section id="apps" class="container">
    <h2 class="section-title">Herramientas</h2>
    <div class="apps">
      <article class="card app-card">
        <h3>üìù Buscador de Concursos de Superior</h3>
        <p class="subtitle">Consult√° y filtr√° concursos vigentes del nivel superior.</p>
        <a class="btn-link" href="https://docentesbrown.github.io/concursos_superior/" target="_blank" rel="noopener">Abrir</a>
      </article>
      <article class="card app-card">
        <h3>üí∏ Calculadora Salarial</h3>
        <p class="subtitle">Simul√° el salario docente seg√∫n cargo, horas y antig√ºedad.</p>
        <a class="btn-link" href="https://docentesbrown.github.io/Calculadora.Salarial.Docentes.Brown/" target="_blank" rel="noopener">Abrir</a>
      </article>
      <article class="card app-card">
        <h3>üéØ Buscador de Profes Particulares</h3>
        <p class="subtitle">Encontr√° profes por zona, localidad y materia.</p>
        <a class="btn-link" href="https://docentesbrown.github.io/buscador.particular/" target="_blank" rel="noopener">Abrir</a>
      </article>
    </div>
  </section>

  <!-- Podcast -->
  <section id="podcast" class="container">
    <div class="card" style="padding:1.5rem">
      <h2 class="section-title">üéôÔ∏è Podcast Docentes Brown</h2>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin:.4rem 0 1rem 0">
        <a id="btnPodcastRSS" class="btn btn-outline" href="#">RSS Podcast</a>
      </div>
      <div id="podcastList" class="audio-list" aria-live="polite"></div>
    </div>
  </section>

  <!-- Noticias -->
  <section id="noticias" class="container">
    <div class="card" style="padding:1.5rem">
      <h2 class="section-title">üóûÔ∏è Noticias</h2>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin:.4rem 0 1rem 0">
        <button id="btnPrev" class="btn btn-outline">Anterior</button>
        <button id="btnNext" class="btn btn-outline">Siguiente</button>
        <a id="btnNewsRSS" class="btn btn-outline" href="#">RSS Noticias</a>
      </div>
      <div id="newsList" class="news-list" aria-live="polite"></div>
      <small class="subtitle" id="newsMeta"></small>
    </div>
  </section>

  <!-- Sumate -->
  <!-- Sumate (toda la tarjeta abre el formulario) -->
  <section id="sumate" class="container">
    <a class="card cta" href="https://forms.gle/TALg7vqSe8f6LzxK8" target="_blank" rel="noopener" style="text-decoration:none;">
      <div>
        <h3 style="margin:.2rem 0;color:var(--violeta)">¬øSos docente? Sumate a la gu√≠a</h3>
        <p style="margin:.2rem 0;color:var(--gris)">Complet√° el formulario y publicamos tu perfil con contacto y materias.</p>
      </div>
      <div class="cta-row">
        <span class="btn btn-primary" role="button" aria-label="Abrir formulario de Sumate">Abrir formulario</span>
      </div>
    </a>
  </section>

  <footer>
    <div class="container">
      <div style="display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap;align-items:center">
        <small>¬© <span id="year"></span> Docentes Brown. Hecho con ‚ô• en Almirante Brown.</small>
        <small>Creado por <a href="https://instagram.com/docentesbrown" target="_blank" rel="noopener">@docentesbrown</a></small>
      </div>
    </div>
  </footer>

  <div class="floating">
    <a class="wa" href="https://wa.me/5491153196358" target="_blank" rel="noopener" aria-label="WhatsApp">
      <!-- WhatsApp icon -->
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.05 11.998a8.99 8.99 0 0 1-12.96 7.964L3 21l1.077-4.006A8.99 8.99 0 1 1 21.05 12Z"></path><path d="M8 12c.2 1 1.5 2.5 2.5 3s1 .5 1.5 0l1-1.5c.4-.6.2-1-.4-1.3l-.7-.4c-.6-.3-.8-.2-1.1.2l-.2.3c-.2.3-.5.3-.8.1-.6-.4-1.3-1-1.8-1.7-.2-.3-.2-.6.1-.8l.3-.2c.4-.3.5-.5.2-1.1l-.4-.7c-.4-.6-.7-.8-1.3-.4L7 7.9C6.5 8.4 6.4 9.2 7 10c.3.5.7 1.1 1 2Z"></path></svg>
      <span>WhatsApp</span>
    </a>
    <a class="cafecito" href="https://cafecito.app/docentesbrown" target="_blank" rel="noopener" aria-label="Cafecito">‚òï Don√° un cafecito</a>
  </div>

  <script>
    // A√±o din√°mico
    document.getElementById('year').textContent = new Date().getFullYear();

    // Modo oscuro toggle
    const rootHtml = document.documentElement;
    const savedTheme = localStorage.getItem('db_theme');
    if(savedTheme){ rootHtml.setAttribute('data-theme', savedTheme); }
    document.getElementById('toggleTheme').addEventListener('click', ()=>{
      const current = rootHtml.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      rootHtml.setAttribute('data-theme', current);
      localStorage.setItem('db_theme', current);
    });

    // Helpers: cargar JSON externo con fallback
    async function loadJson(url, fallback){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if(!r.ok) throw new Error('fetch failed');
        const data = await r.json();
        return Array.isArray(data) ? data : fallback;
      }catch(e){ return fallback; }
    }

    // Fallbacks locales
    const PODCASTS_FALLBACK = [
      {titulo:'Episodio 1 ‚Äî Mapa Escolar', fecha:'2025-10-01', spotify:'https://open.spotify.com/episode/1IaOxq5Gi0xQbEoy2ccDdQ?si=6OWrMns7RuSqpCzhEeKVCw', descripcion:'Charlamos sobre el nuevo Mapa Escolar online.'},
      {titulo:'Episodio ejemplo ‚Äî Pr√≥ximamente', fecha:'2025-09-15', spotify:'https://open.spotify.com/episode/0example3', descripcion:'Plantilla para el pr√≥ximo episodio.'}
    ];

    const NEWS_FALLBACK = [
      {titulo:'El nuevo Mapa Escolar ya est√° online: m√°s r√°pido e intuitivo', fecha:'2025-10-03', link:'https://abc.gob.ar/noticias/el-nuevo-mapa-escolar-ya-esta-online-mas-rapido-intuitivo-y-con-herramientas-innovadoras', resumen:'La DGCyE present√≥ la nueva versi√≥n con herramientas innovadoras.', img:''},
      {titulo:'Convocatoria a concursos 2025', fecha:'2025-09-15', link:'https://docentesbrown.github.io/concursos_superior/', resumen:'Se publicaron nuevas bases y condiciones.', img:''},
      {titulo:'Calculadora Salarial: nueva actualizaci√≥n', fecha:'2025-09-10', link:'https://docentesbrown.github.io/Calculadora.Salarial.Docentes.Brown/', resumen:'Correcciones y mejoras de accesibilidad.', img:''}
    ];

    let PODCASTS = PODCASTS_FALLBACK; // Para producci√≥n, pod√©s cargarlos de archivos JSON en el repo.
    let NEWS = NEWS_FALLBACK; // Para producci√≥n, pod√©s cargarlos de archivos JSON en el repo.

    async function initPodcasts(){
      PODCASTS = await loadJson('podcasts.json', PODCASTS_FALLBACK);
      PODCASTS.sort((a,b)=> new Date(b.fecha)-new Date(a.fecha));
      const $pod = document.getElementById('podcastList');
      if(!$pod) return;
      if(!PODCASTS.length){ $pod.innerHTML = '<p class="subtitle">Pronto subimos los primeros episodios.</p>'; return; }
      $pod.innerHTML = PODCASTS.map(p=>{
        const url = p.spotify || '#';
        const embed = url.includes('/embed/') ? url : url.replace('/episode/','/embed/episode/').replace('/show/','/embed/show/');
        return `
          <article class="card audio-card">
            <h4>${p.titulo}</h4>
            <p class="subtitle" style="margin:.2rem 0 .6rem 0">${new Date(p.fecha).toLocaleDateString()} ‚Äî ${p.descripcion||''}</p>
            <div class="spotify-embed">
              <div class="eq" aria-hidden="true"><span></span><span></span><span></span></div>
              <iframe data-testid="embed-iframe" style="border-radius:12px" src="${embed}" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            </div>
          </article>`;
      }).join('');
    }
      $pod.innerHTML = PODCASTS.map(p=>`
        <article class="card audio-card">
          <h4>${p.titulo}</h4>
          <p class="subtitle" style="margin:.2rem 0 .6rem 0">${new Date(p.fecha).toLocaleDateString()} ‚Äî ${p.descripcion||''}</p>
          <audio controls preload="none" style="width:100%">
            <source src="${p.file}" type="audio/mpeg" />
            Tu navegador no soporta audio HTML5.
          </audio>
        </article>
      `).join('');
    }

    // RSS Podcast
    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id==='btnPodcastRSS'){
        e.preventDefault();
        const items = PODCASTS.map(p=>`<item><title>${p.titulo}</title><pubDate>${new Date(p.fecha).toUTCString()}</pubDate><link>${p.spotify||location.href}</link></item>`).join('');
        const rss = `<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"><channel><title>Podcast Docentes Brown</title><link>${location.href}</link><description>Episodios</description>${items}</channel></rss>`;
        const blob = new Blob([rss], {type:'application/rss+xml'});
        const url = URL.createObjectURL(blob);
        const a=document.createElement('a');a.href=url;a.download='podcast.xml';a.click();URL.revokeObjectURL(url);
      }
    });

    let newsPage = 1, pageSize = 6;
    function renderNewsPaged(){
      const $news = document.getElementById('newsList');
      const $meta = document.getElementById('newsMeta');
      if(!$news) return;
      if(!NEWS.length){ $news.innerHTML = '<p class="subtitle">Sin novedades por ahora.</p>'; return; }
      // ordenar por fecha desc
      NEWS.sort((a,b)=> new Date(b.fecha) - new Date(a.fecha));
      const totalPages = Math.max(1, Math.ceil(NEWS.length / pageSize));
      newsPage = Math.min(Math.max(1, newsPage), totalPages);
      const start = (newsPage-1)*pageSize;
      const slice = NEWS.slice(start, start+pageSize);
      $news.innerHTML = slice.map(n=>`
        <article class="card news-item">
          <h4>${n.titulo}</h4>
          <p class="subtitle" style="margin:.2rem 0">${new Date(n.fecha).toLocaleDateString()}</p>
          <p style="margin:.2rem 0;color:var(--gris)">${n.resumen||''}</p>
          ${n.link?`<a class="btn-link" href="${n.link}" target="_blank" rel="noopener">Ver m√°s</a>`:''}
        </article>
      `).join('');
      if($meta) $meta.textContent = `P√°gina ${newsPage} de ${totalPages} ‚Äî ${NEWS.length} noticias`;
    }

    function renderNewsTop(){
      const cont = document.getElementById('newsCarousel');
      if(!cont) return;
      NEWS.sort((a,b)=> new Date(b.fecha) - new Date(a.fecha));
      const top = NEWS.slice(0,3);
      const slide = cont.querySelector('.news-slide');
      if(!top.length){ slide.innerHTML = '<p class="subtitle" style="color:#fff;margin:1rem">Sin novedades por ahora.</p>'; return; }
      slide.innerHTML = buildSlide(top[0]);
      const dotsWrap = cont.querySelector('.news-dots');
      dotsWrap.innerHTML = top.map((_,i)=>`<button role="tab" class="news-dot ${i===0?'active':''}" data-i="${i}" aria-label="Ir a noticia ${i+1}"></button>`).join('');
      cont.querySelector('.news-prev').onclick = ()=> carouselPrev();
      cont.querySelector('.news-next').onclick = ()=> carouselNext();
      dotsWrap.onclick = (e)=>{ if(e.target && e.target.classList.contains('news-dot')){ goTo(+e.target.dataset.i); } };
      window.__DB_CAROUSEL__ = {items: top, i:0, el:cont, timer:null};
      startCarousel();
    }
    function buildSlide(n){
      const bg = n.img? `<div class='news-bg' style="background-image:url('${n.img}')"></div>`: `<div class='news-bg'></div>`;
      const link = n.link? `<a class="btn-link" href="${n.link}" target="_blank" rel="noopener">Ver m√°s</a>`: '';
      return `${bg}<div class='news-content'><h2>${n.titulo}</h2><p>${n.resumen||''}</p>${link}</div>`;
    }
    function startCarousel(){ const s = window.__DB_CAROUSEL__; stopCarousel(); if(!s) return; s.timer=setInterval(carouselNext,5000); }
    function stopCarousel(){ const s = window.__DB_CAROUSEL__; if(s&&s.timer){ clearInterval(s.timer); s.timer=null; } }
    function carouselNext(){ const s = window.__DB_CAROUSEL__; if(!s) return; s.i=(s.i+1)%s.items.length; renderSlide(); }
    function carouselPrev(){ const s = window.__DB_CAROUSEL__; if(!s) return; s.i=(s.i-1+s.items.length)%s.items.length; renderSlide(); }
    function goTo(i){ const s = window.__DB_CAROUSEL__; if(!s) return; s.i=i% s.items.length; renderSlide(); }
    function renderSlide(){ const s = window.__DB_CAROUSEL__; const slide = s.el.querySelector('.news-slide'); slide.style.opacity=0; setTimeout(()=>{ slide.innerHTML = buildSlide(s.items[s.i]); slide.style.opacity=1; const dots=[...s.el.querySelectorAll('.news-dot')]; dots.forEach((d,idx)=>d.classList.toggle('active', idx===s.i)); },180); }</h4>
          <p class="subtitle" style="margin:.2rem 0">${new Date(n.fecha).toLocaleDateString()}</p>
          <p style="margin:.2rem 0;color:var(--gris)">${n.resumen||''}</p>
          ${n.link?`<a class="btn-link" href="${n.link}" target="_blank" rel="noopener">Ver m√°s</a>`:''}
        </article>
      `).join('');
    }

    async function initNews(){
      NEWS = await loadJson('news.json', NEWS_FALLBACK);
      renderNewsTop();
      renderNewsPaged();
    }

    // Paginaci√≥n y RSS Noticias
    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id==='btnNext'){newsPage++; renderNewsPaged();}
      if(e.target && e.target.id==='btnPrev'){newsPage--; renderNewsPaged();}
      if(e.target && e.target.id==='btnNewsRSS'){
        e.preventDefault();
        const items = NEWS.map(n=>`<item><title>${n.titulo}</title><pubDate>${new Date(n.fecha).toUTCString()}</pubDate><link>${n.link||location.href}</link><description>${(n.resumen||'')}</description></item>`).join('');
        const rss = `<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"><channel><title>Noticias Docentes Brown</title><link>${location.href}</link><description>Novedades</description>${items}</channel></rss>`;
        const blob = new Blob([rss], {type:'application/rss+xml'});
        const url = URL.createObjectURL(blob);
        const a=document.createElement('a');a.href=url;a.download='noticias.xml';a.click();URL.revokeObjectURL(url);
      }
    });

    

    // Inicializar
    (async ()=>{
      await initPodcasts();
      await initNews();
    })();

    // ------------------
    // AUTO‚ÄëTESTS LIGEROS
    // ------------------
    (async function runSelfTests(){
      const results = [];
      try{
        // Test 1: loadJson debe devolver el fallback si el JSON no es un array
        const fb = [1,2];
        const dataUrlNotArray = 'data:application/json,%7B%7D'; // {}
        const out = await loadJson(dataUrlNotArray, fb);
        results.push({name:'loadJson fallback', pass: Array.isArray(out) && out.length===2});

        // Test 2: botones/elementos clave existen
        results.push({name:'#newsTop existe', pass: !!document.getElementById('newsTop')});
        results.push({name:'#podcastList existe', pass: !!document.getElementById('podcastList')});

        // Test 3: toggle de modo oscuro cambia el atributo
        const btn = document.getElementById('toggleTheme');
        const prev = document.documentElement.getAttribute('data-theme')||'light';
        btn.click();
        const after = document.documentElement.getAttribute('data-theme')||'light';
        const toggled = prev!==after;
        // volver a estado previo
        btn.click();
        results.push({name:'Modo oscuro toggle', pass: toggled});

        // Log
        const allPass = results.every(r=>r.pass);
        console.log('[DB Tests]', results);
        if(!allPass){
          console.warn('Alg√∫n test fall√≥:', results.filter(r=>!r.pass));
        }
      }catch(err){
        console.error('Error en tests:', err);
      }
    })();
  </script>
</body>
</html>
